<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            margin: 0;
            padding: 20px;
        }
        h1 {
            text-align: center;
        }
        .container {
            max-width: 1000px;
            background: #fff;
            margin: 0 auto;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: relative;
        }
        .add-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 8px 14px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 50px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background: #f2f2f2;
        }
        td.name-cell {
            cursor: pointer;
            color: black;
            text-decoration: none;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0; top: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            overflow: auto;
        }
        .modal-content {
            background: #fff;
            margin: 8% auto;
            padding: 20px;
            border-radius: 8px;
            width: 350px;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: stretch;
        }
        .modal-content input[type="text"], 
        .modal-content input[type="email"], 
        .modal-content input[type="password"] {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            box-sizing: border-box;
        }
        .input-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
            margin-top: 5px;
        }
        .input-group input {
            flex: 1;
            margin: 0;
        }
        .input-group button {
            white-space: nowrap;
        }
        .modal-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
        }
        .left-buttons {
            flex: 1;
        }
        .right-buttons {
            display: flex;
            gap: 8px;
        }
        .modal-content button {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
        }
        .confirm { background: #4CAF50; color: #fff; }
        .cancel { background: #f44336; color: #fff; }
        .generate-btn {
            background: #2196F3;
            color: white;
            cursor: pointer;
        }
        .delete-btn {
            background: #e91e63;
            color: white;
        }
    </style>
</head>
<body>
    <h1>Admin Panel</h1>
    <div class="container">
        <button class="add-btn" onclick="openAddModal()">Yangi Hodim Qo‘shish</button>
        <table id="workerTable">
            <thead>
                <tr>
                    <th>Ism Sharif</th>
                    <th>Kelgan sana</th>
                    <th>Kelgan soat</th>
                    <th>Ketgan sana</th>
                    <th>Ketgan soat</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- Add/Edit Modal -->
    <div id="addModal" class="modal">
        <div class="modal-content">
            <h3 id="modalTitle">Yangi Hodim Qo‘shish</h3>
            <input type="text" id="firstname" placeholder="Ism">
            <input type="text" id="lastname" placeholder="Familiya">
            <input type="email" id="email" placeholder="Email">
            <input type="password" id="password" placeholder="Parol">
            <div class="input-group">
                <input type="text" id="generateNum" placeholder="Generate Number" maxlength="4">
                <button class="generate-btn" onclick="generateNumber()">Generate</button>
            </div>

            <div class="modal-buttons">
                <div class="left-buttons">
                    <button id="deleteBtn" class="delete-btn" style="display: none;" onclick="openConfirmDelete()">O‘chirish</button>
                </div>
                <div class="right-buttons">
                    <button id="mainActionBtn" class="confirm">Yaratish</button>
                    <button class="cancel" onclick="closeAddModal()">Bekor qilish</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirm Delete Modal -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <h3>O‘chirishni xohlaysizmi?</h3>
            <div class="right-buttons" style="justify-content: center; margin-top: 20px;">
                <button class="confirm" onclick="deleteWorker()">Ha</button>
                <button class="cancel" onclick="closeConfirmModal()">Yo‘q</button>
            </div>
        </div>
    </div>

    <script>
        const fakeData = [
            { fullname: 'Ali Karimov', dateIn: '01/05/2025', timeIn: '09:00', dateOut: '', timeOut: '' },
            { fullname: 'Dilnoza Ismoilova', dateIn: '02/05/2025', timeIn: '10:30', dateOut: '', timeOut: '' },
            { fullname: 'Bekzod Toshmatov', dateIn: '03/05/2025', timeIn: '14:15', dateOut: '', timeOut: '' }
        ];

        let editingRow = null;

        function populateTable() {
            const table = document.getElementById('workerTable').getElementsByTagName('tbody')[0];
            fakeData.forEach(item => {
                const row = table.insertRow();
                const nameCell = row.insertCell(0);
                nameCell.innerText = item.fullname;
                nameCell.className = 'name-cell';
                nameCell.onclick = () => openEditModal(row);

                row.insertCell(1).innerText = item.dateIn;
                row.insertCell(2).innerText = item.timeIn;
                row.insertCell(3).innerText = item.dateOut;
                row.insertCell(4).innerText = item.timeOut;
            });
        }

        function generateNumber() {
            let num = Math.floor(Math.random() * 9000) + 1000;
            document.getElementById('generateNum').value = num;
        }

        function openAddModal() {
            editingRow = null;
            document.getElementById('modalTitle').innerText = 'Yangi Hodim Qo‘shish';
            document.getElementById('mainActionBtn').innerText = 'Yaratish';
            document.getElementById('mainActionBtn').onclick = addWorker;
            document.getElementById('deleteBtn').style.display = 'none';
            clearAddModalInputs();
            document.getElementById('addModal').style.display = 'block';
        }

        function openEditModal(row) {
            editingRow = row;
            const [fullname, dateIn, timeIn, dateOut, timeOut] = [
                row.cells[0].innerText, row.cells[1].innerText, row.cells[2].innerText,
                row.cells[3].innerText, row.cells[4].innerText
            ];
            const [firstname, lastname] = fullname.split(' ');
            document.getElementById('firstname').value = firstname || '';
            document.getElementById('lastname').value = lastname || '';
            document.getElementById('email').value = '';
            document.getElementById('password').value = '';
            document.getElementById('generateNum').value = '';

            document.getElementById('modalTitle').innerText = 'Ma\'lumotni Yangilash';
            document.getElementById('mainActionBtn').innerText = 'Yangilash';
            document.getElementById('mainActionBtn').onclick = updateWorker;
            document.getElementById('deleteBtn').style.display = 'inline-block';

            document.getElementById('addModal').style.display = 'block';
        }

        function addWorker() {
            const firstname = document.getElementById('firstname').value.trim();
            const lastname = document.getElementById('lastname').value.trim();
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value.trim();
            const genNum = document.getElementById('generateNum').value.trim();

            if (!firstname || !lastname || !email || !password || !genNum) {
                alert('Barcha maydonlarni to‘ldiring!');
                return;
            }

            const fullname = firstname + ' ' + lastname;
            const dateIn = new Date().toLocaleDateString('uz-UZ');
            const timeIn = new Date().toLocaleTimeString('uz-UZ', {hour: '2-digit', minute:'2-digit'});
            const dateOut = '';
            const timeOut = '';

            const table = document.getElementById('workerTable').getElementsByTagName('tbody')[0];
            const row = table.insertRow();
            const nameCell = row.insertCell(0);
            nameCell.innerText = fullname;
            nameCell.className = 'name-cell';
            nameCell.onclick = () => openEditModal(row);

            row.insertCell(1).innerText = dateIn;
            row.insertCell(2).innerText = timeIn;
            row.insertCell(3).innerText = dateOut;
            row.insertCell(4).innerText = timeOut;

            closeAddModal();
            clearAddModalInputs();
        }

        function updateWorker() {
            if (!editingRow) return;

            const firstname = document.getElementById('firstname').value.trim();
            const lastname = document.getElementById('lastname').value.trim();

            if (!firstname || !lastname) {
                alert('Ism va familiya bo‘sh bo‘lishi mumkin emas!');
                return;
            }

            const fullname = firstname + ' ' + lastname;
            editingRow.cells[0].innerText = fullname;
            editingRow.cells[1].innerText = new Date().toLocaleDateString('uz-UZ');
            editingRow.cells[2].innerText = new Date().toLocaleTimeString('uz-UZ', {hour: '2-digit', minute:'2-digit'});

            closeAddModal();
            clearAddModalInputs();
        }

        function openConfirmDelete() {
            document.getElementById('confirmModal').style.display = 'block';
        }

        function closeConfirmModal() {
            document.getElementById('confirmModal').style.display = 'none';
        }

        function deleteWorker() {
            if (editingRow) {
                editingRow.remove();
            }
            closeConfirmModal();
            closeAddModal();
            clearAddModalInputs();
        }

        function closeAddModal() {
            document.getElementById('addModal').style.display = 'none';
        }

        function clearAddModalInputs() {
            document.getElementById('firstname').value = '';
            document.getElementById('lastname').value = '';
            document.getElementById('email').value = '';
            document.getElementById('password').value = '';
            document.getElementById('generateNum').value = '';
        }

        window.onclick = function(event) {
            if (event.target == document.getElementById('addModal')) {
                closeAddModal();
            }
            if (event.target == document.getElementById('confirmModal')) {
                closeConfirmModal();
            }
        };

        window.onload = populateTable;

        document.getElementById('generateNum').addEventListener('input', function (e) {
            this.value = this.value.replace(/[^0-9]/g, '').slice(0,4);
        });
    </script>
</body>
</html>
